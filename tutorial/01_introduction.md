# 第一章：深度研究 (Deep Research) —— 颠覆与重塑：AI Agent 的终极进化

线上演示：https://agent.rpcx.io
代码仓库：https://github.com/smallnest/goskills

**拒绝黑盒，拒绝框架依赖！** 本系列教程将通过四章硬核实战，带你使用纯 **Go 语言**从零手搓一个**生产级 Deep Research Agent**。我们将深度拆解每一个核心组件，亲手实现从自主规划、深度搜索到多模态报告生成的全链路逻辑，真正掌握 Agent 开发的**核心原力**。

## 1. 简介

在人工智能飞速发展的今天，我们正在见证从简单的“对话 (Chat)”向“深度研究 (Deep Research)”的范式转变。虽然像 GPT-4 和 Claude 3 这样的传统大型语言模型 (LLM) 彻底改变了我们生成文本和代码的方式，但它们往往难以应对需要综合数十个来源信息的复杂、多步骤调查任务。

**深度研究 (Deep Research)** Agent 应运而生。它们不仅仅是回答问题的聊天机器人；它们是自主系统，旨在思考、规划和执行通常需要人类分析师花费数小时甚至数天才能完成的综合研究任务。

## 2. 什么是深度研究？

“深度研究”指的是能够进行深入、多步骤调查的 AI Agent。与检索少量文档并进行总结的标准搜索引擎或 RAG（检索增强生成）系统不同，深度研究 Agent 能够：

1.  **分解**：将复杂的用户查询分解为多个子问题。
2.  **迭代搜索**：在网络上进行迭代搜索，分析结果并决定是否需要更多信息。
3.  **阅读和分析**：阅读和分析各种格式的内容（网页、PDF、数据表）。
4.  **综合**：将发现通过引用综合成一份结构化、全面的报告。
5.  **多模态生成**：除了文本，还能生成包含图表、图片甚至 PPT 的多模态报告。

### 关键特征
-   **Agent 工作流**：使用“思考 -> 行动 -> 观察”的循环来浏览网络。
-   **长上下文理解**：可以在会话期间处理和保留大量信息。
-   **自我修正**：如果搜索路径进入死胡同，Agent 可以回溯并尝试不同的策略。

## 3. 演变：从搜索到研究

| 特性 | 传统搜索 | RAG (聊天机器人) | 深度研究 Agent |
| :--- | :--- | :--- | :--- |
| **交互方式** | 基于关键词 | 问答 (单轮) | 目标导向 (多轮) |
| **深度** | 表面链接 | 摘要片段 | 全面综合 |
| **时间框架** | 秒级 | 秒级 | 分钟级 (5-30 分钟) |
| **输出** | URL 列表 | 短段落 | 详细报告 / 文章 |
| **自主性** | 无 | 低 | 高 |

## 4. 领先的工具和技术

截至 2024 年底和 2025 年初，几个主要参与者定义了这个领域：

### OpenAI Deep Research
集成在 ChatGPT Pro 中，该工具使用先进的推理模型（如 o3）进行“深度挖掘”。其特点包括：
-   **高准确性**：在“Humanity's Last Exam”等基准测试中优于其他模型。
-   **深度**：能够生成非常长、详细的报告。
-   **工具使用**：可以无缝使用浏览器、代码解释器和文件上传。

### Google Gemini Deep Research
利用 Google 庞大的搜索索引和具有 200 万+ token 上下文窗口的 Gemini 1.5 Pro 模型。
-   **实时信息**：擅长查找绝对最新的新闻和数据。
-   **多模态**：可以处理视频和音频内容作为研究的一部分。
-   **集成**：与 Google Workspace 生态系统深度集成。

### Perplexity AI
作为“答案引擎”的先驱，Perplexity 的“深度研究”模式专注于：
-   **速度与可用性**：比某些竞争对手更快地提供结构化答案。
-   **引用**：对每个主张进行严格的脚注，便于验证。
-   **Pro Search**：一种 Agent 搜索，在开始之前会询问澄清性问题。

## 5. 幕后工作原理 (通用架构)

深度研究 Agent 的架构通常包括：

1.  **规划器 (Planner)**：一个 LLM，将高级目标分解为任务列表（例如，“查找市场规模”、“识别竞争对手”、“比较定价”）。
2.  **浏览器/爬虫 (Browser/Scraper)**：一个能够渲染重 JavaScript 页面、提取文本并绕过基本反机器人措施的工具。
3.  **上下文管理器 (Context Manager)**：一个用于存储目前找到的相关片段的系统，通常使用向量数据库或长上下文 LLM 窗口。
4.  **作者/合成器 (Writer/Synthesizer)**：最后一步，获取所有收集到的笔记并起草最终文档，确保逻辑流畅和正确引用。

## 6. 优缺点

### 优势
-   **效率**：自动化收集数据的繁琐“苦力活”。
-   **广度**：可以覆盖比人类通常有耐心阅读的更多来源。
-   **结构**：输出格式一致，易于阅读。

### 局限性与风险
-   **幻觉**：尽管有所改进，Agent 仍然可能误解数据或引用不存在的来源。
-   **成本与延迟**：这些请求计算成本高且速度慢（需要几分钟）。
-   **偏见**：输出仅取决于它找到的搜索结果；它可能会放大现有的网络偏见。

## 7. 我们的主角：agent-web

在本教程中，我们将重点介绍 **agent-web**，这是一个完全使用 Go 语言从零开始构建的深度研究 Agent。

### 为什么选择 agent-web？

与市面上其他流行的开源 Agent 框架相比，`agent-web` 具有独特的优势：

| 特性 | LangChain Deep Research Agent | ByteDance DeerFlow | agent-web |
| :--- | :--- | :--- | :--- |
| **语言** | Python | Python | **Go** |
| **框架依赖** | 强依赖 LangChain/LangGraph | 基于 LangChain/LangGraph | **零依赖 (Pure Go)** |
| **架构复杂度** | 高 (抽象层多) | 高 (企业级复杂) | **简洁 (清晰的 Planner-Executor)** |
| **性能** | 一般 (Python 解释器) | 一般 | **高 (Go 编译型语言)** |
| **部署** | 较重 (依赖环境多) | 较重 | **单二进制文件** |

**agent-web** 的核心理念是**去繁就简**。它不依赖庞大的 LangChain 生态系统，而是回归编程本质，使用 Go 语言强大的并发能力和清晰的结构来实现复杂的 Agent 逻辑。这使得它非常适合学习 Agent 原理，以及在生产环境中进行轻量级部署。

> **极简部署**：得益于 Go 语言的静态编译特性，`agent-web` 编译后仅生成**一个独立的二进制文件**， 不需要配置文件和网页依赖文件。这意味着你无需配置复杂的 Python 环境（如 venv, conda），也无需安装成堆的依赖包。只需将这个文件拷贝到服务器上，即可直接运行！

### 核心功能

`agent-web` 具备以下强大的核心能力，使其成为 Deep Research 的理想选择：

1.  **自主规划 (Autonomous Planning)**
    根据用户提出的复杂问题，自动拆解为搜索、阅读、分析、撰写报告等一系列有序的子任务。

2.  **深度搜索 (Deep Search)**
    集成 Tavily 等专业搜索工具，能够实时获取互联网上的最新信息，并支持多轮迭代搜索以补充缺失信息。

3.  **智能分析 (Intelligent Analysis)**
    对海量搜索结果进行去噪、提炼和深度思考，识别关键信息并剔除无关内容。

4.  **专业报告 (Professional Reporting)**
    最终生成结构清晰、内容详实、包含引用的 Markdown 研报。

5.  **多模态输出 (Multimodal Output)**
    不仅支持文本报告，还具备生成 Podcast 音频、PPT 演示文稿等多模态内容的能力。

6.  **双重交互 (Dual Interface)**
    同时提供极客风的 CLI 命令行界面和现代化的 Web 图形界面，满足不同用户习惯。

7.  **人机协同 (Human-in-the-loop)**
    允许用户在 Agent 规划和执行过程中进行干预，修改计划或提供反馈，确保研究方向的准确性。

8.  **技能扩展 (Skill & MCP Support)**
    支持加载自定义 Skill 和 MCP (Model Context Protocol) 工具，无限扩展 Agent 的能力边界。

9.  **会话回放 (Session Replay)**
    完整记录 Agent 的思考和执行过程，支持随时回放和复盘，便于调试和分享。

### 架构与工作流

`agent-web` 采用了经典的 **Planner-Executor-SubAgents** 架构，这与我们前面提到的通用架构高度一致，但实现更为精简：

1.  **Planner (规划者)**：接收用户请求，生成初步的研究计划。
2.  **Executor (执行者)**：根据计划调度任务。
3.  **SubAgents (子 Agent)**：执行具体的搜索、阅读、总结任务。

![Agent Workflow](../docs/images/agent_worflow.png)

整个流程是动态的，Agent 会根据每一步的搜索结果动态调整后续的计划，直到收集到足够的信息来生成最终报告。

### 安装与使用

`agent-web` 的安装非常简单，因为它是一个标准的 Go 项目。

#### 前置要求
你需要获取以下 API Key：
-   **OpenAI API Key**: 用于驱动 LLM (支持兼容 OpenAI 协议的其他模型)。
-   **Tavily API Key**: 用于网络搜索 (Deep Research 的关键)。

#### 多样的交互界面

`agent-web` 提供了两种强大的交互方式，满足不同场景的需求：

**1. CLI 命令行界面**
适合开发者调试和服务器环境使用，清晰展示 Agent 的思考与规划过程。

![Agent CLI Interface](../docs/images/agent_plan.png)

**2. Web 图形界面**
提供现代化的用户体验，支持可视化任务管理、实时进度跟踪和报告展示。

![Agent Web Interface](../docs/images/agent_web.png)

#### 快速开始

1.  **设置环境变量**：
    ```bash
    export OPENAI_API_KEY="YOUR_OPENAI_KEY"
    export TAVILY_API_KEY="YOUR_TAVILY_KEY"
    ```

2.  **编译并运行**：
    在项目根目录下执行：
    ```bash
    make
    ./agent-web -v
    ```

3.  **访问 Web 界面**：
    启动后，打开浏览器访问 `http://localhost:8080` (默认端口)，你将看到一个现代化的 Web 界面，可以开始你的深度研究之旅。

    > **在线 Demo**: 你也可以访问 [https://agent.rpcx.io](https://agent.rpcx.io) 体验在线版本。

## 8. 结论

深度研究代表了生成式 AI 的成熟。我们正在从“生成文本”转向“生成洞察”。对于开发人员和用户而言，了解如何利用（和构建）这些 Agent 是 AI 时代的下一个关键技能。

在接下来的章节中，我们将深入 `agent-web` 的代码，探索如何使用 Go 构建这样一个强大的深度研究 Agent。
